<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Content – QuickToppers</title>
<link rel="icon" type="image/jpg" href="img/icon.jpg">

<!-- Tailwind -->
<script src="https://cdn.tailwindcss.com"></script>

<!-- Icons -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/js/all.min.js" defer></script>

<style>
    :root{
        --bg:#070914;
        --panel: rgba(255,255,255,0.04);
        --panel-border: rgba(255,255,255,0.06);
        --accent:#2fb7ff;
        --accent-2:#4a8bff;
    }

    body {
        background: var(--bg);
        color:#e7eefc;
        font-family: Inter, sans-serif;
        overflow-x:hidden;
    }

    .glass {
        background: var(--panel);
        border: 1px solid var(--panel-border);
        backdrop-filter: blur(10px) saturate(120%);
    }

    .glow-card {
        position:relative;
        border-radius:16px;
        overflow:hidden;
        transition: transform .2s ease;
    }
    .glow-card:hover { transform:scale(1.03); }

    .glow-card::before{
        content:"";
        position:absolute;
        inset:-2px;
        border-radius:18px;
        background:linear-gradient(60deg, rgba(47,183,255,.2), rgba(74,139,255,.2));
        filter:blur(12px);
        z-index:-1;
        animation: glowShift 4s linear infinite;
        background-size:300% 300%;
    }

    @keyframes glowShift {
        0%{ background-position:0% 50%; }
        50%{ background-position:100% 50%; }
        100%{ background-position:0% 50%; }
    }

    .tab-active{
        background:linear-gradient(90deg,var(--accent),var(--accent-2));
        color:white;
    }

    #sidebar {
        transform:translateX(-100%);
        transition:.4s ease;
    }
    #sidebar.open { transform:translateX(0); }

    #splash {
        position:fixed;
        inset:0;
        background:var(--bg);
        z-index:9999;
        display:flex;
        align-items:center;
        justify-content:center;
        animation: fadeOut 1s ease forwards;
        animation-delay:1.1s;
    }
    @keyframes fadeOut { to { opacity:0; visibility:hidden; } }
</style>
</head>
<body>

<!-- SPLASH -->
<div id="splash">
    <div class="text-center">
        <div class="text-4xl font-bold text-blue-400 mb-2">QuickToppers</div>
        <div class="text-sm text-blue-200">Loading...</div>
    </div>
</div>

<!-- SIDEBAR -->
<div id="sidebar" class="fixed top-0 left-0 w-64 h-full glass p-5 z-50">
    <button onclick="toggleSidebar()" class="text-blue-300 text-xl mb-4">
        <i class="fa-solid fa-xmark"></i>
    </button>

    <h2 class="text-xl font-bold mb-4 text-blue-400">QuickToppers</h2>

    <div class="text-xs text-blue-300 mb-2">INSTITUTE</div>
    <ul class="space-y-2">
        <li><a href="index.html" class="flex gap-3 p-2 glass rounded hover:bg-blue-500/20"><i class="fa-solid fa-house"></i> Home</a></li>
        <li><a href="batches.html?id=80NT" class="flex gap-3 p-2 glass rounded hover:bg-blue-500/20"><i class="fa-solid fa-layer-group"></i> NextToppers</a></li>
        <li><a href="batches.html?id=30PW" class="flex gap-3 p-2 glass rounded hover:bg-blue-500/20"><i class="fa-solid fa-book"></i> PhysicsWallah</a></li>
    </ul>

    <div class="text-xs text-blue-300 mt-6 mb-2">TOOLS</div>
    <ul class="space-y-2">
        <li><a href="#" class="flex gap-3 p-2 glass rounded hover:bg-blue-500/20"><i class="fa-solid fa-download"></i> Downloader</a></li>
    </ul>
</div>

<!-- NAVBAR -->
<nav class="glass px-4 py-3 flex justify-between items-center sticky top-0 z-40">
    <button id="backBtn" class="text-blue-300 text-xl hidden" onclick="goBack()">
        <i class="fa-solid fa-arrow-left"></i>
    </button>

    <button id="menuBtn" onclick="toggleSidebar()" class="text-blue-300 text-xl">
        <i class="fa-solid fa-bars"></i>
    </button>

    <h1 class="text-lg font-semibold"><span class="text-white">Quick</span><span class="text-blue-400">Toppers</span></h1>
    <div></div>
</nav>

<!-- HEADING -->
<section class="max-w-3xl mx-auto px-4 mt-6 glass p-5 rounded-xl text-center">
    <h2 id="subjectTitle" class="text-3xl font-bold"></h2>
</section>

<!-- TABS -->
<div class="max-w-3xl mx-auto px-4 mt-6 flex gap-4">
    <button id="videoTab" class="flex-1 glass p-3 rounded-lg text-center font-semibold tab-active">Videos</button>
    <button id="notesTab" class="flex-1 glass p-3 rounded-lg text-center font-semibold">Notes</button>
</div>

<!-- CHAPTER LIST -->
<div id="chapterBox" class="max-w-4xl mx-auto px-4 py-8"></div>

<script>

function toggleSidebar(){ document.getElementById("sidebar").classList.toggle("open"); }

const params = new URLSearchParams(window.location.search);
const inst = params.get("institute");
const batch = params.get("batch");
const subject = params.get("subject");

const chapterBox = document.getElementById("chapterBox");
let mode = "video";
let openedChapter = null;

// Tab switching
document.getElementById("videoTab").onclick = () => { mode="video"; setTabs(); refreshCurrentChapter(); }
document.getElementById("notesTab").onclick = () => { mode="notes"; setTabs(); refreshCurrentChapter(); }

function setTabs(){
    videoTab.classList.toggle("tab-active", mode==="video");
    notesTab.classList.toggle("tab-active", mode==="notes");
}

let SUBJECT_SOURCE_LINK = "";   // GitHub JSON link
let GITHUB_DATA = null;         // fetched GitHub chapter/lecture data

// Load subject → find GitHub link → fetch full content
async function loadContent(){

    // Step 1: Load LOCAL content.json
    const res = await fetch("data/content.json");
    const data = await res.json();

    // Validate
    if(!data[inst] || !data[inst][batch] || !data[inst][batch][subject]) {
        chapterBox.innerHTML = `
        <div class="glass p-6 text-center rounded-xl text-red-400 text-lg font-semibold">
            <i class="fa-solid fa-circle-exclamation text-red-500 text-3xl mb-3"></i><br>
            Content Not Found
        </div>`;
        return;
    }

    document.getElementById("subjectTitle").innerText =
        subject.charAt(0).toUpperCase()+subject.slice(1);

    // Step 2: Pick GitHub source link
    SUBJECT_SOURCE_LINK = data[inst][batch][subject].source;

    if(!SUBJECT_SOURCE_LINK){
        chapterBox.innerHTML = `
        <div class="glass p-6 text-center rounded-xl text-red-400 text-lg font-semibold">
            Missing GitHub Subject Source Link
        </div>`;
        return;
    }

    // Step 3: Fetch FULL CHAPTER DATA from GitHub JSON
    try{
        const gh = await fetch(SUBJECT_SOURCE_LINK);
        GITHUB_DATA = await gh.json();
    }
    catch(e){
        chapterBox.innerHTML = `
        <div class="glass p-6 text-center rounded-xl text-red-400 text-lg font-semibold">
            Cannot load Subject Content (GitHub JSON Error)
        </div>`;
        return;
    }

    // Step 4: Load chapters on screen
    const chapters = GITHUB_DATA.chapters;
    chapterBox.innerHTML = "";

    chapters.forEach(ch=>{
        chapterBox.innerHTML += `
        <div id="card_${ch.id}" class="glow-card glass p-5 mb-4">

            <div class="flex justify-between items-center">
                <h3 class="text-xl font-semibold">${ch.title}</h3>

                <button class="glass px-4 py-2 rounded-md hover:bg-blue-500/30"
                    onclick="openChapter('${ch.id}')">
                    Open
                </button>
            </div>

            <div id="content_${ch.id}" class="mt-4 hidden"></div>
        </div>`;
    });
}


// CHAPTER OPEN
async function openChapter(id){
    openedChapter = id;

    document.getElementById("menuBtn").classList.add("hidden");
    document.getElementById("backBtn").classList.remove("hidden");

    const cards = document.querySelectorAll("#chapterBox > div");
    cards.forEach(c => c.style.display="none");

    document.getElementById(`card_${id}`).style.display = "block";

    loadLectures(id);
}


// Load lectures from GitHub JSON (GITHUB_DATA)
function loadLectures(id){

    const chapter = GITHUB_DATA.chapters.find(c => c.id === id);
    let html = "";

    chapter.videos.forEach(v=>{
        const btnURL = `player.html?institute=${inst}&batch=${batch}&subject=${subject}&chapter=${id}&lecture=${v.id}`;

        html += `
        <div class="glow-card glass p-4 mb-4">

            <h4 class="font-semibold mb-2">${v.title}</h4>

            <button onclick="location.href='${btnURL}'"
                class="w-full p-3 rounded-md text-white flex justify-center gap-2"
                style="background:linear-gradient(90deg,var(--accent),var(--accent-2));">
                <i class="fa-solid fa-play"></i> Let's Study
            </button>

        </div>`;
    });

    const box = document.getElementById("content_" + id);
    box.innerHTML = html;
    box.classList.remove("hidden");
}

function refreshCurrentChapter(){
    if(openedChapter){
        loadLectures(openedChapter);
    }
}

function goBack(){
    openedChapter = null;

    document.getElementById("menuBtn").classList.remove("hidden");
    document.getElementById("backBtn").classList.add("hidden");

    loadContent();
}

loadContent();

</script>

</body>
    </html>
