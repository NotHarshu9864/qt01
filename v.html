<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>QuickToppers Player</title>

<!-- Tailwind CDN -->
<script src="https://cdn.tailwindcss.com"></script>

<!-- Plyr CSS -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/plyr/3.7.8/plyr.css" />

<style>
    body {
        background: #020617; /* slate-950 */
    }
    video {
        border-radius: 12px;
    }
</style>
</head>

<body class="min-h-screen flex items-center justify-center p-4">

<!-- MAIN CARD -->
<div class="w-full max-w-4xl bg-slate-900/60 backdrop-blur-2xl shadow-xl rounded-2xl p-6 border border-cyan-600/30">

    <!-- HEADER -->
    <div class="flex items-center space-x-4 mb-6">
        <img src="img/icon.jpg" class="w-12 h-12 rounded-lg shadow-lg border border-cyan-500/40" />
        <h1 class="text-3xl font-bold text-cyan-400 tracking-wide">QuickToppers Player</h1>
    </div>

    <!-- VIDEO CONTAINER -->
    <div class="rounded-xl overflow-hidden shadow-2xl border border-slate-700">
        <video id="player" playsinline controls></video>
    </div>

</div>

<!-- Plyr JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/plyr/3.7.8/plyr.min.js"></script>
<!-- HLS -->
<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

<script>
// Fetch ?url=
function getURL(key) {
    return new URLSearchParams(window.location.search).get(key);
}

const videoURL = getURL("url");
const video = document.getElementById("player");

if (!videoURL) {
    alert("No video URL found. Please use ?url=yourlink.m3u8");
} else {
    if (Hls.isSupported()) {
        const hls = new Hls({
            maxBufferLength: 30,
            maxBufferSize: 60 * 1000 * 1000,
        });

        hls.loadSource(videoURL);
        hls.attachMedia(video);

        hls.on(Hls.Events.MANIFEST_PARSED, function (event, data) {
            const available = hls.levels.map((l) => l.height);

            const player = new Plyr(video, {
                controls: [
                    'play-large', 'play', 'progress', 
                    'current-time', 'mute', 'volume',
                    'settings', 'fullscreen'
                ],
                settings: ['quality', 'speed'],
                quality: {
                    default: available[0],
                    options: available,
                    forced: true,
                    onChange: (q) => {
                        hls.levels.forEach((level, index) => {
                            if (level.height === q) hls.currentLevel = index;
                        });
                    },
                },
            });
        });

    } else if (video.canPlayType("application/vnd.apple.mpegurl")) {
        video.src = videoURL;
        const player = new Plyr(video);
    }
}
</script>

</body>
</html>